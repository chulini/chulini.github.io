<html>
<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="google-site-verification" content="VrJ_5sbiz02gK5WqwfSLQ8V2XP4T2R1Zn0frzu90R7w" />
<link rel="icon" href="/images/icon2-64.png" type="image/x-icon" />

<link rel="stylesheet" href="/css/reset.css">


    
<link rel="stylesheet" href="/css/style.css">

    
<link rel="stylesheet" href="/css/highlight.css">

    
<link rel="stylesheet" href="/css/zdog.css">

    
    
    <link href="https://fonts.googleapis.com/css?family=Vollkorn&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro&display=swap" rel="stylesheet">
    <title>{NotYet‚ö°}</title>

    <link href="https://fonts.googleapis.com/css?family=Varela+Round&display=swap" rel="stylesheet">
<meta name="generator" content="Hexo 4.2.0"></head>

    
    <body>
        <div class="top-band"></div>
        <div class="wrap">
            <header>
    <a href="/" class="header-link-home">
        <img src="/images/logo2.png">
    </a>
    <ul class="nav nav-list">
        <li class="nav-list-item"><a class="nav-list-link" href="/">Home</a></li>
        <li class="nav-list-item"><a class="nav-list-link" href="/blog">Blog</a></li>
        <li class="nav-list-item"><a class="nav-list-link" href="/games">Games</a></li>
        <li class="nav-list-item"><a class="nav-list-link" href="/about">About</a></li>
    </ul>
    
</header>


            <div class="middle">
                
<div class="join" >
    <img class="join-bg" src="/images/bubble.svg">
    <div class="join-content">

        <!-- Begin Mailchimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
    #mc_embed_signup{background: transparent; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
    #mc_embed_signup label, #mc_embed_signup p{
        font-family: 'Source Code Pro', monospace;
        color: #000;
        font-weight: bold;
        margin: 0 0 20px 0;
        line-height: 30px;
        font-size: 14px;
        text-align: center;
    }
    #mc_embed_signup p{color:#666; font-weight: normal;}
	/* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
	   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<form action="https://games.us4.list-manage.com/subscribe/post?u=2bb8a45b43e13f5409852b77a&amp;id=c672452f30" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
    <label for="mce-EMAIL">üëÄ Subcribe to upcoming games (*cough cough* JetJump... üèÉüí•üí®) and special promotions.</label>
	<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_2bb8a45b43e13f5409852b77a_c672452f30" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
<p><img src="/images/spam2.gif" /></p>
</div>

<!--End mc_embed_signup-->

        <!-- div class="join-left">
            <h2><a href="https://discord.gg/3KVcU8p" target="_blank" rel="noopener">Let's stay in touch! Join the discord channel</a></h2>
            <p>See you there!ü§úüí•ü§õ</p>
        </div>
        <div class="join-right">
            <a href="https://discord.gg/3KVcU8p" target="_blank" rel="noopener"><img src="/images/discord.png" class="join-discord"></a>
        </div -->
        <!-- div class="join-middle"></div>
        <div class="join-right">
            <p>Receive news about my next game release (I will not spam you. I hate spam too!)</p>
            <form>
                <input type="text">
            </form>
        </div -->
    </div>
    
</div>

<div class="post-content">
    <h2 class="title"><a href="/mp4-to-webm/index.html">Convert Mp4 to Webm</a></h2>
    <p class="date">Nov 18th 2019</p>
    <p>At the moment of creating this blog, I had the problem of having pretty heavy <code>mp4</code> videos and I knew that <code>webm</code> files tend to be smaller and more streaming friendly. So I ended up making a script that converts an <code>mp4</code> file to <code>webm</code> using the <code>ffmpeg</code> open-source command.</p>
<p>This is the following you have to do to make the conversion.</p>
<a id="more"></a>

<h1 id="1-Install-ffmpeg-4"><a href="#1-Install-ffmpeg-4" class="headerlink" title="1.- Install ffmpeg-4"></a>1.- Install ffmpeg-4</h1><h2 id="1-1-Add-repository"><a href="#1-1-Add-repository" class="headerlink" title="1.1.- Add repository"></a>1.1.- Add repository</h2><p>If you install ffmpeg with the default repositories you will install ffmpeg version 3. In my case I just installed the version 4 which worked like a charm. To install ffmpeg 4 you need to add a repository with this command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo add-apt-repository ppa:jonathonf/ffmpeg-4</span><br></pre></td></tr></table></figure>

<h2 id="1-2-Upgrade-and-update"><a href="#1-2-Upgrade-and-update" class="headerlink" title="1.2.- Upgrade and update"></a>1.2.- Upgrade and update</h2><p>Be sure you have the latest version of everything</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update &amp;&amp; sudo apt-get upgrade</span><br></pre></td></tr></table></figure>

<h2 id="1-3-Install-ffmpeg"><a href="#1-3-Install-ffmpeg" class="headerlink" title="1.3.- Install ffmpeg"></a>1.3.- Install ffmpeg</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install ffmpeg</span><br></pre></td></tr></table></figure>

<p>And say yes to all.</p>
<p>At this moment if you check the <strong>ffmpeg</strong> version you installed. It should say ffmpeg version 4.x.x</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ffmpeg -version</span><br><span class="line">ffmpeg version 4.1.3-0york1~16.04 Copyright (c) 2000-2019 the FFmpeg developers</span><br><span class="line">(... tons of verbose nonsense nobody understands or care...)</span><br></pre></td></tr></table></figure>

<p>You have already <strong>ffmpeg</strong> installed. Cool!</p>
<h1 id="2-Use-ffmpeg-to-convert-mp4-to-webm-with-a-script"><a href="#2-Use-ffmpeg-to-convert-mp4-to-webm-with-a-script" class="headerlink" title="2.- Use ffmpeg to convert mp4 to webm with a script"></a>2.- Use ffmpeg to convert mp4 to webm with a script</h1><p>There are many ways to convert <code>mp4</code> to <code>webm</code> format. The best quality converstion that worked for me was the two-pass enconding described <a href="https://trac.ffmpeg.org/wiki/Encode/VP9" target="_blank" rel="noopener">here</a>. </p>
<p>As you have to put input and output filenames multiple times plus many parameters and stuff, I just made a <code>nodejs</code> script that do that job for me. </p>
<h2 id="2-1-Create-a-convert-js"><a href="#2-1-Create-a-convert-js" class="headerlink" title="2.1.- Create a convert.js"></a>2.1.- Create a convert.js</h2><p>Create an empty file <strong>in the same directory you have the videos</strong> you want to convert. Name it <code>convert.js</code> and put this on it:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);</span><br><span class="line"><span class="keyword">const</span> exec = util.promisify(<span class="built_in">require</span>(<span class="string">'child_process'</span>).exec);</span><br><span class="line"><span class="keyword">const</span> args = process.argv.slice(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">let</span> filename = args[<span class="number">0</span>].split(<span class="string">"."</span>)[<span class="number">0</span>];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`Converting <span class="subst">$&#123;filename&#125;</span>.mp4 to <span class="subst">$&#123;filename&#125;</span>.webm`</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`yes | ffmpeg -i <span class="subst">$&#123;filename&#125;</span>.mp4 -c:v libvpx-vp9 -b:v 2M -pass 1 -an -f webm /dev/null &amp;&amp; ffmpeg -i <span class="subst">$&#123;filename&#125;</span>.mp4 -c:v libvpx-vp9 -b:v 2M -pass 2 -c:a libopus <span class="subst">$&#123;filename&#125;</span>.webm`</span>)</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">convert</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; stdout, stderr &#125; = <span class="keyword">await</span> exec(<span class="string">`yes | ffmpeg -i <span class="subst">$&#123;filename&#125;</span>.mp4 -c:v libvpx-vp9 -b:v 2M -pass 1 -an -f webm /dev/null &amp;&amp; ffmpeg -i <span class="subst">$&#123;filename&#125;</span>.mp4 -c:v libvpx-vp9 -b:v 2M -pass 2 -c:a libopus <span class="subst">$&#123;filename&#125;</span>.webm`</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'stdout:'</span>, stdout);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'stderr:'</span>, stderr);</span><br><span class="line">    &#125;<span class="keyword">catch</span> (e)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'stdout:'</span>, e.stdout);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'stderr:'</span>, e.stderr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">convert();</span><br></pre></td></tr></table></figure>

<h2 id="2-2-Convert-and-wait"><a href="#2-2-Convert-and-wait" class="headerlink" title="2.2.- Convert and wait"></a>2.2.- Convert and wait</h2><p>The conversion script does not require any extra package which is awesome so we don‚Äôt need to install anything.<br>To run it you just need go to the directory you have the videos and run:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ node convert.js filename.mp4</span><br></pre></td></tr></table></figure>

<p>This will generate a <code>filename.webm</code> in the same directory.</p>
<p>As two-pass conversion is pretty slow (but generate awesome results) it will take some time so don‚Äôt worry if nothing happens for a while. Just wait.</p>
<h2 id="Known-bugs"><a href="#Known-bugs" class="headerlink" title="Known bugs"></a>Known bugs</h2><p>I didn‚Äôt have too much time to make the script. I just needed something that does the job so is not a super strict-clean-perfect-correct script.</p>
<p>Please consider ths following limitations:</p>
<ol>
<li>It will not convert the file when the filename has spaces on it so rename your file if that happens.</li>
<li>The script prints nothing until the hole <code>webm</code> file has been made so be patient and don‚Äôt worry.</li>
</ol>
<p>Feel free to fix anything you want. Here is the <a href="https://gist.github.com/chulini/484aaf19312b1aa1bc1a891ace3bd57d" target="_blank" rel="noopener">gist</a>.</p>

</div>

<div class="join" >
    <img class="join-bg" src="/images/bubble.svg">
    <div class="join-content">

        <!-- Begin Mailchimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
    #mc_embed_signup{background: transparent; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
    #mc_embed_signup label, #mc_embed_signup p{
        font-family: 'Source Code Pro', monospace;
        color: #000;
        font-weight: bold;
        margin: 0 0 20px 0;
        line-height: 30px;
        font-size: 14px;
        text-align: center;
    }
    #mc_embed_signup p{color:#666; font-weight: normal;}
	/* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
	   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<form action="https://games.us4.list-manage.com/subscribe/post?u=2bb8a45b43e13f5409852b77a&amp;id=c672452f30" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
    <label for="mce-EMAIL">üëÄ Subcribe to upcoming games (*cough cough* JetJump... üèÉüí•üí®) and special promotions.</label>
	<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_2bb8a45b43e13f5409852b77a_c672452f30" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
<p><img src="/images/spam2.gif" /></p>
</div>

<!--End mc_embed_signup-->

        <!-- div class="join-left">
            <h2><a href="https://discord.gg/3KVcU8p" target="_blank" rel="noopener">Let's stay in touch! Join the discord channel</a></h2>
            <p>See you there!ü§úüí•ü§õ</p>
        </div>
        <div class="join-right">
            <a href="https://discord.gg/3KVcU8p" target="_blank" rel="noopener"><img src="/images/discord.png" class="join-discord"></a>
        </div -->
        <!-- div class="join-middle"></div>
        <div class="join-right">
            <p>Receive news about my next game release (I will not spam you. I hate spam too!)</p>
            <form>
                <input type="text">
            </form>
        </div -->
    </div>
    
</div>


<div id="disqus_thread"></div>

            </div>
        </div>
        <div class="footer">
    <p>Website made in <a href="https://hexo.io/" target="_blank">Hexo</a>. Home animation made in <a href="https://zzz.dog/" target="_blank">ZDog</a>. With ‚ù§Ô∏è by <a href="http://twitter.com/chulini" target="_blank">JQ</a>.</p>
</div>

    <script>
      var disqus_shortname = 'notyet-1';
      
      var disqus_url = 'https://notyet.games/mp4-to-webm/';
      
      (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//go.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    
    

    </body>    
    

</html>